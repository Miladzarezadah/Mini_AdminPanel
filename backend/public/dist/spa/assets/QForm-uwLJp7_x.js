import{l as v,o as A,L as B,as as h,g as b,j,r as k,m as q,a as I,h as O,n as R,f as P,p as V,at as w}from"./index-CmeDau2E.js";import{h as L}from"./QPage-fNGnxIIR.js";function K(){let e;const a=b();function n(){e=void 0}return v(n),A(n),{removeTick:n,registerTick(c){e=c,B(()=>{e===c&&(h(a)===!1&&e(),e=void 0)})}}}function M(){let e=null;const a=b();function n(){e!==null&&(clearTimeout(e),e=null)}return v(n),A(n),{removeTimeout:n,registerTimeout(c,s){n(),h(a)===!1&&(e=setTimeout(()=>{e=null,c()},s))}}}let Q=!1;{const e=document.createElement("div");e.setAttribute("dir","rtl"),Object.assign(e.style,{width:"1px",height:"1px",overflow:"auto"});const a=document.createElement("div");Object.assign(a.style,{width:"1000px",height:"1px"}),document.body.appendChild(e),e.appendChild(a),e.scrollLeft=-1e3,Q=e.scrollLeft>=0,e.remove()}const U=j({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:a,emit:n}){const c=b(),s=k(null);let f=0;const l=[];function p(t){const u=typeof t=="boolean"?t:e.noErrorFocus!==!0,m=++f,C=(o,r)=>{n(`validation${o===!0?"Success":"Error"}`,r)},E=o=>{const r=o.validate();return typeof r.then=="function"?r.then(i=>({valid:i,comp:o}),i=>({valid:!1,comp:o,err:i})):Promise.resolve({valid:r,comp:o})};return(e.greedy===!0?Promise.all(l.map(E)).then(o=>o.filter(r=>r.valid!==!0)):l.reduce((o,r)=>o.then(()=>E(r).then(i=>{if(i.valid===!1)return Promise.reject(i)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return m===f&&C(!0),!0;if(m===f){const{comp:r,err:i}=o[0];if(i!==void 0&&console.error(i),C(!1,r),u===!0){const F=o.find(({comp:T})=>typeof T.focus=="function"&&h(T.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function g(){f++,l.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function y(t){t!==void 0&&P(t);const u=f+1;p().then(m=>{u===f&&m===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function x(t){t!==void 0&&P(t),n("reset"),B(()=>{g(),e.autofocus===!0&&e.noResetFocus!==!0&&d()})}function d(){L(()=>{if(s.value===null)return;const t=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),u=>u.tabIndex!==-1);t?.focus({preventScroll:!0})})}V(w,{bindComponent(t){l.push(t)},unbindComponent(t){const u=l.indexOf(t);u!==-1&&l.splice(u,1)}});let S=!1;return v(()=>{S=!0}),q(()=>{S===!0&&e.autofocus===!0&&d()}),I(()=>{e.autofocus===!0&&d()}),Object.assign(c.proxy,{validate:p,resetValidation:g,submit:y,reset:x,focus:d,getValidationComponents:()=>l}),()=>O("form",{class:"q-form",ref:s,onSubmit:y,onReset:x},R(a.default))}});export{U as Q,M as a,Q as r,K as u};
